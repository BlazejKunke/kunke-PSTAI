---
---

<section id="join" class="py-20 lg:py-24">
  <div class="container mx-auto px-4">
    <div class="max-w-2xl mx-auto text-center">
      <h2 class="text-3xl lg:text-4xl font-bold text-text mb-8">Join PSTAI</h2>
      
      <p class="text-lg text-gray-700 mb-12">
        Ready to be part of Poland's premier AI training community? Fill out the form below and we'll get back to you soon.
      </p>
      
      <form 
        id="join-form" 
        class="space-y-6 text-left"
        novalidate
      >
        <div style="position: absolute; left: -5000px;">
          <input type="text" name="honeypot" tabindex="-1" autocomplete="off">
        </div>
        
        <div>
          <label for="join-name" class="block text-sm font-medium text-text mb-2">
            Name *
          </label>
          <input 
            type="text" 
            id="join-name" 
            name="name" 
            required 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
            aria-describedby="join-name-error"
          >
          <div id="join-name-error" class="text-red-600 text-sm mt-1 hidden" role="alert"></div>
        </div>
        
        <div>
          <label for="join-email" class="block text-sm font-medium text-text mb-2">
            Email *
          </label>
          <input 
            type="email" 
            id="join-email" 
            name="email" 
            required 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
            aria-describedby="join-email-error"
          >
          <div id="join-email-error" class="text-red-600 text-sm mt-1 hidden" role="alert"></div>
        </div>
        
        <div>
          <label for="join-role" class="block text-sm font-medium text-text mb-2">
            Role
          </label>
          <select 
            id="join-role" 
            name="role" 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
          >
            <option value="">Select your role</option>
            <option value="trainer">AI Trainer</option>
            <option value="educator">Educator</option>
            <option value="consultant">Consultant</option>
            <option value="researcher">Researcher</option>
            <option value="student">Student</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div>
          <label for="join-message" class="block text-sm font-medium text-text mb-2">
            Message (optional)
          </label>
          <textarea 
            id="join-message" 
            name="message" 
            rows="4" 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
            placeholder="Tell us about your experience or interests..."
          ></textarea>
        </div>
        
        <div>
          <label class="flex items-start space-x-3">
            <input 
              type="checkbox" 
              id="join-consent" 
              name="consent" 
              required 
              class="mt-1 h-4 w-4 text-primary border-gray-300 rounded focus:ring-2 focus:ring-primary"
              aria-describedby="join-consent-error"
            >
            <span class="text-sm text-gray-700">
              I agree to be contacted by PSTAI regarding membership and related activities. *
            </span>
          </label>
          <div id="join-consent-error" class="text-red-600 text-sm mt-1 hidden" role="alert"></div>
        </div>
        
        <button 
          type="submit" 
          class="w-full bg-primary text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span id="join-submit-text">Submit Application</span>
          <span id="join-loading" class="hidden">Submitting...</span>
        </button>
        
        <div id="join-status" class="text-center text-sm hidden" role="status" aria-live="polite"></div>
      </form>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('join-form') as HTMLFormElement;
    const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const submitText = document.getElementById('join-submit-text') as HTMLElement;
    const loading = document.getElementById('join-loading') as HTMLElement;
    const status = document.getElementById('join-status') as HTMLElement;
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      clearErrors();
      
      if (!validateForm()) {
        return;
      }
      
      const formData = new FormData(form);
      
      if (formData.get('honeypot')) {
        return;
      }
      
      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      loading.classList.remove('hidden');
      status.classList.add('hidden');
      
      try {
        const response = await fetch(import.meta.env.FORM_ACTION_JOIN || '/api/join', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          status.textContent = 'Thank you! We\'ll be in touch soon.';
          status.className = 'text-center text-sm text-green-600 bg-green-50 p-4 rounded-lg';
          status.classList.remove('hidden');
          form.reset();
        } else {
          throw new Error('Submission failed');
        }
      } catch (error) {
        status.textContent = 'Something went wrong. Please try again or contact us directly.';
        status.className = 'text-center text-sm text-red-600 bg-red-50 p-4 rounded-lg';
        status.classList.remove('hidden');
      } finally {
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        loading.classList.add('hidden');
      }
    });
    
    function validateForm(): boolean {
      let isValid = true;
      
      const name = form.querySelector('#join-name') as HTMLInputElement;
      const email = form.querySelector('#join-email') as HTMLInputElement;
      const consent = form.querySelector('#join-consent') as HTMLInputElement;
      
      if (!name.value.trim()) {
        showError('join-name-error', 'Name is required');
        isValid = false;
      }
      
      if (!email.value.trim()) {
        showError('join-email-error', 'Email is required');
        isValid = false;
      } else if (!isValidEmail(email.value)) {
        showError('join-email-error', 'Please enter a valid email address');
        isValid = false;
      }
      
      if (!consent.checked) {
        showError('join-consent-error', 'You must agree to be contacted');
        isValid = false;
      }
      
      return isValid;
    }
    
    function showError(errorId: string, message: string): void {
      const errorEl = document.getElementById(errorId) as HTMLElement;
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
    }
    
    function clearErrors(): void {
      const errors = form.querySelectorAll('[id$="-error"]');
      errors.forEach(error => {
        error.classList.add('hidden');
        error.textContent = '';
      });
    }
    
    function isValidEmail(email: string): boolean {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
  });
</script>